<%@page import="mx.com.televisa.derechocorporativo.modules.reports.apoderados.RepApoderados"%>
<%@page import="mx.com.televisa.derechocorporativo.data.Record"%>
<%@page import="java.util.ArrayList"%>
<%@page import="java.lang.reflect.Array"%>
<%@page import="mx.com.televisa.derechocorporativo.model.Catalog"%>
<%@page import="mx.com.televisa.derechocorporativo.model.CatalogElement"%>
<%@page import="java.util.List"%>
<%@page import="mx.com.televisa.derechocorporativo.modules.reports.tenecascada.TenenciaCascada"%>
<%@ taglib prefix="f" uri="http://java.sun.com/jsf/core"%>
<%@ taglib prefix="h" uri="http://java.sun.com/jsf/html"%>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c"%>
<%@page import="mx.com.televisa.derechocorporativo.components.JSCal"%>
<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Insert title here</title>

<%@include file="/css/kaz-styles.jsp"%>

<script type="text/javascript">

function waitBar() {
	
	document.getElementById('imgCapWait').style.display = '';
	document.getElementById('btnEjecutar').style.display = 'none';
}


	
function openSelectPupUp(catalogId, targetIds, targetNames, namesProperty, currentValue) {

    var left = screen.width - ((screen.width - 300) / 2);
    var top = (screen.height - 300) / 2;  // for 25% - devide by 4  |  for 33% - devide by 3

	newwindow=window.open('../../components/simpleSelectPupUp/simpleselect.jsp?catalogId=' + catalogId + '&targetIds=' + targetIds + '&targetNames=' + targetNames + '&currentValue=' + currentValue + '&namesProperty=' + namesProperty,
						'name',
						'height=600,width=450,toolbar=0,menubar=0,location=0,status=0,scrollbars=1,resizable=1,left=' + left + ',top=' + top);

	if (window.focus) {newwindow.focus()}

	return false;
}


function openMultiSelectPupUp(catalogId, targetIds, targetNames, namesProperty, currentValue) {

    var left = screen.width - ((screen.width - 300) / 2);
    var top = (screen.height - 300) / 2;  // for 25% - devide by 4  |  for 33% - devide by 3

	newwindow=window.open('../../components/multiselectPupUp/multiselect.jsp?catalogId=' + catalogId + '&targetIds=' + targetIds + '&targetNames=' + targetNames + '&currentValue=' + currentValue + '&namesProperty=' + namesProperty,
						'name',
						'height=600,width=450,toolbar=0,menubar=0,location=0,status=0,scrollbars=1,resizable=1,left=' + left + ',top=' + top);

	if (window.focus) {newwindow.focus()}

	return false;
}

	
</script>


</head>
<body onload="">

			<jsp:include page="/jsp/components/pages_border/open-pre-title.jsp"></jsp:include>
			
				Reporte de Apoderados
			
			<jsp:include page="/jsp/components/pages_border/open-post-title.jsp"></jsp:include>

<form action="" method="post">


<table width="100%">
	<tr>
		<td colspan="3">

<%

	request.setCharacterEncoding("UTF-8");

	String btnEjecutar = request.getParameter("btnEjecutar"); 
	
	String hiddenEmpresa = 	(request.getParameter("hiddenEmpresa") != null) ? request.getParameter("hiddenEmpresa") : "";
	String hiddenTipoPoder = 	(request.getParameter("hiddenTipoPoder") != null) ? request.getParameter("hiddenTipoPoder") : "";
	
	ArrayList<Record> records = null;
	
	if(btnEjecutar != null && btnEjecutar.equals("Consultar")) {
		
		
		records = RepApoderados.getInfo(hiddenEmpresa, hiddenTipoPoder);
		
		
		
		//String paramString = "";
		//paramString += (request.getParameter("hiddenConsolida") != null) ? 		"&hiddenConsolida=" + request.getParameter("hiddenConsolida") : "";
	}			
	
	
	String showMode = "TREE";
	
	
%>


		</td>
	</tr>	
	<tr>
		<td colspan="3">
			<table width="100%">
				<tr>
					<td width="5%"></td>
					<td width="10%">Empresa(s):</td>
					<td width="40%">
					
						<input type="hidden" id='hiddenEmpresa' name='hiddenEmpresa' value='<%=hiddenEmpresa%>'>
						<input id='txtEmpresa' name='txtEmpresa' size="50" value="<%= (request.getParameter("txtEmpresa")!=null)? request.getParameter("txtEmpresa") : ""%>">
						<input type='button' value='...' onclick="openMultiSelectPupUp('EMPRESAS','hiddenEmpresa','txtEmpresa','value',document.getElementById('hiddenEmpresa').value)">
					</td>
					<td width="5%"></td>
					<td width="20%">Tipo de Poder:</td>
					<td width="20%">
						<input type="hidden" id='hiddenTipoPoder' name='hiddenTipoPoder' value='<%=hiddenTipoPoder%>'>
						<input id='txtTipoPoder' name='txtTipoPoder' size="15" value="<%= (request.getParameter("txtTipoPoder")!=null)? request.getParameter("txtTipoPoder") : ""%>">
						<input type='button' value='...' onclick="openMultiSelectPupUp('41','hiddenTipoPoder','txtTipoPoder','value',document.getElementById('hiddenTipoPoder').value)">
					</td>
				</tr>
			
				<tr>
					<td colspan="6" align="right">
					
						<input type="submit" id='btnEjecutar' name='btnEjecutar' value='Consultar' onclick="waitBar()">
			
						<img src='<%= request.getContextPath() %>/img/wait-bar.gif' id='imgCapWait' style="display: none;">
					</td>
				</tr>
				
			</table>
		</td>
	</tr>
	<tr>
		<td colspan="3"><hr></td>
	</tr>
	<tr>
		<td colspan="3">
			<br>
		</td>
	</tr>
	<tr>
		<td colspan="3" align="left">
	
				<%
				if(records != null) {
					
					if(showMode.equals("TABLE")){
				%>
				
					
			<table width="100%">
				<tr>
					<th class="tableHeader">
					Empresa
					</th>
					<th class="tableHeader">
					Escritura
					</th>
					<th class="tableHeader">
					Tipo de Poder
					</th>
					<th class="tableHeader">
					Grupo
					</th>
					<th class="tableHeader">
					Nombre Apoderado
					</th>
					<th class="tableHeader">
					Concepto Poder
					</th>
					<th class="tableHeader">
					Poder
					</th>
				</tr>
				
				<%
					for(Record rec : records) {
				%>
				<tr>
					<td>
						<%= rec.get("NOM_EMPRESA") %>
					</td>
					<td>
						<%= rec.get("DES_ESCRITURA") %>
					</td>
					<td>
						<%= rec.get("TIPO_PODER") %>
					</td>
					<td>
						<%= rec.get("DES_GRUPO") %>
					</td>
					<td>
						<%= rec.get("NOMBRE_APODERADO") %>
					</td>
					<td>
						<%= rec.get("CONCEPTO_PODER") %>
					</td>
					<td>
						<%= rec.get("DESCRIPCION_PODER") %>
					</td>					
				</tr>
				
				
				<%
					}
				%>
			</table>
				<%
				} if(showMode.equals("TREE")) {
				%>
				
				
				
				<%
				
					String lastEmpresa = "";
					String lastEscritura = "";
					String lastTipoPoder = "";
					String lastGrupo = "";
					String lastNombre = "";
					String lastConcepto = "";
					String lastPoder = "";
				
					for(Record rec : records) {
				%>
					
					<%
						if(!lastEmpresa.equals(rec.get("NOM_EMPRESA"))) {
							
							lastEmpresa = rec.get("NOM_EMPRESA");
						
						%>
							
							<h2>
							<%= rec.get("NOM_EMPRESA") %>
							</h2>
							
						<%	
						}
					%>
				
					<%
						if(!lastEscritura.equals(rec.get("DES_ESCRITURA"))) {
							
							lastEscritura = rec.get("DES_ESCRITURA");
						
						%>
							<br>
							<b>
							<span style="color:#D2E0F6">. . . . . . . .</span> 
							<span style="font-size: 15px">
							Escritura: <%= rec.get("DES_ESCRITURA") %>
							</span>
							</b>
							
						<%	
						}
					%>
				
					<%
						if(!lastTipoPoder.equals(rec.get("TIPO_PODER"))) {
							
							lastTipoPoder = rec.get("TIPO_PODER");
						
						%>
						
					<br>
					
							<b>
							<span style="color:#D2E0F6">
							. . . . . . . .
							. . . . . . . .
							</span>
							<span style="font-size: 15px">
							<%= rec.get("TIPO_PODER") %>
							</span>
							</b>
							
						<%	
						}
					%>
				
				
				
					<%
						if(!lastGrupo.equals(rec.get("DES_GRUPO"))) {
							
							lastGrupo = rec.get("DES_GRUPO");
						
						%>
								<br><br>
				
							<b>
							<span style="color:#D2E0F6">
							. . . . . . . .
							. . . . . . . .
							. . . . . . . .
							</span>
							<span style="font-size: 15px">
							Grupo: <%= rec.get("DES_GRUPO") %>
							</span>
							</b>
							
						<%	
						}
					%>
					
					
					

				
					<%
						if(!lastNombre.equals(rec.get("NOMBRE_APODERADO"))) {
							
							lastNombre = rec.get("NOMBRE_APODERADO");
						
						%>
													<br>
							<span style="color:#D2E0F6">
							. . . . . . . .
							. . . . . . . .
							. . . . . . . .
							. . . . . . . .
							</span>
							<span style="font-size: 15px">
							<%= rec.get("NOMBRE_APODERADO") %>
							</span>
							
						<%	
						}
					%>
					
					
				
					<%
						if(!lastConcepto.equals(rec.get("CONCEPTO_PODER"))) {
							
							lastConcepto = rec.get("CONCEPTO_PODER");
						
						%>
							
						<br>
							<span style="color:#D2E0F6">
							. . . . . . . .
							. . . . . . . .
							. . . . . . . .
							. . . . . . . .
							. . . . . . . .
							</span>
							<%= rec.get("CONCEPTO_PODER") %>
							
							
						<%	
						}
					%>
					
					

				
					<%
						if(!lastPoder.equals(rec.get("DESCRIPCION_PODER"))) {
							
							lastPoder = rec.get("DESCRIPCION_PODER");
						
						%>
							
						<br>				
							<span style="color:#D2E0F6">			
							. . . . . . . .
							. . . . . . . .
							. . . . . . . .
							. . . . . . . .
							. . . . . . . .
							. . . . . . . .
							</span>
							<%= rec.get("DESCRIPCION_PODER") %>
							
							
						<%	
						}
					%>
					
					
					
					
					
					
				
				
				<%
				}
				 %>
				 
				 <br>
				<%
				}
				 %>
			
			
				No se encontraron registros
				<%
				}
				%>
		</td>
	</tr>
	
	
</table>

</form>

<jsp:include page="/jsp/components/pages_border/close.jsp"></jsp:include>

</body>
</html>